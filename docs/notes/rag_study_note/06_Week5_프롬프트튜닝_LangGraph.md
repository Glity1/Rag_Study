# Week5: 프롬프트 튜닝 및 LangGraph 도입

## 연구 날짜
2025년 11월 5주차

## 연구 목적
다양한 프롬프트 변형을 실험하여 답변 품질을 개선하고, LangGraph를 도입하여 복잡한 워크플로우를 구현한다.

## 실험 1: 프롬프트 튜닝

### 실험 방법
다음 프롬프트 변형을 비교:

1. **기본 프롬프트**: 간단한 지시사항
2. **상세 프롬프트**: 구체적인 답변 형식 요구
3. **예시 포함 프롬프트**: Few-shot 예시 제공
4. **체인 오브 사고**: 단계별 추론 요구
5. **역할 기반 프롬프트**: 전문가 역할 부여

### 실험 결과

| 프롬프트 유형    | 답변 품질 | 완성도 | 관련성 |
|----------------|----------|--------|--------|
| 기본            | 3.5/5    | 3.2/5 | 3.8/5 |
| 상세            | 4.2/5    | 4.0/5 | 4.3/5 |
| 예시 포함        | 4.5/5    | 4.3/5 | 4.6/5 |
| 체인 오브 사고   | 4.3/5    | 4.5/5 | 4.2/5 |
| 역할 기반        | 4.1/5    | 4.0/5 | 4.2/5 |

### 분석 및 인사이트
- **예시 포함 프롬프트**가 가장 높은 품질을 보임
- **체인 오브 사고**는 복잡한 질문에 효과적
- 프롬프트 길이와 품질은 비례하지 않음

## 실험 2: LangGraph 도입

### LangChain vs LangGraph 비교

#### LangChain (Week4)
- **구조**: 선형 체인
- **상태 관리**: 제한적
- **복잡도**: ⭐☆☆☆☆ (단순)
- **확장성**: ⭐⭐☆☆☆

#### LangGraph (Week5)
- **구조**: 그래프 기반 (노드 + 엣지)
- **상태 관리**: 명시적 (RAGState)
- **복잡도**: ⭐⭐☆☆☆ (현재는 단순)
- **확장성**: ⭐⭐⭐⭐⭐

### LangGraph 구현

#### 그래프 구조
```
retrieve → generate → END
```

#### RAGState 정의
```python
class RAGState(TypedDict):
    question: str
    documents: List[Document]  # 검색된 문서 접근 가능
    context: str
    answer: str
```

#### 장점
1. **명시적 상태 관리**: 중간 결과 추적 가능
2. **확장 용이**: 조건부 분기, 루프, 병렬 처리 추가 가능
3. **디버깅 용이**: 각 노드별 입력/출력 확인 가능

### 실험 결과
- **기능적 동일성**: 현재는 LangChain과 동일한 결과
- **확장 가능성**: 복잡한 워크플로우 구현 가능
- **상태 접근**: 검색된 문서를 사용자에게 표시 가능

## 문제 해결

### 인덱스 경로 자동 탐색
- **문제**: 상대 경로(`../../data/processed/index`) 해석 문제
- **해결**: 프로젝트 루트 기준 절대 경로 변환 및 `metadata.json` 자동 탐색

### f-string 백슬래시 오류
- **문제**: `f"{(response.count('\n') + 1):>8}"` 구문 오류
- **해결**: 변수로 분리하여 해결

## 구현 내용

### 주요 파일
- `src/week5/prompt_tuning.py`: 프롬프트 실험 설계 및 비교
- `src/week5/langgraph_rag.py`: LangGraph RAG 구현 (조건부 분기, 재검색 기능 포함)

### 출력 결과
- 프롬프트별 답변 비교
- LangGraph 실행 결과
- 문서 미리보기 기능

## 첨부 파일
- `src/week5/prompt_tuning.py`
- `src/week5/langgraph_rag.py`
- `src/week5/run_week5.py`
- `docs/guides/LANGCHAIN_VS_LANGGRAPH.md`
- `docs/guides/LANGCHAIN_LANGGRAPH_WORKFLOWS.md`
- 프롬프트 실험 결과

## 다음 주차 계획
Week6에서는 FastAPI를 활용하여 RAG 서비스를 REST API로 제공합니다.

---

**작성일**: 2025년 11월 5주차  
**연구자**: [서혁준]


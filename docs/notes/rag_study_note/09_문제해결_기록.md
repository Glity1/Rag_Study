# 문제 해결 기록

## 연구 기간
2025년 11월 전체

## 목적
프로젝트 진행 중 발생한 문제와 해결 과정을 체계적으로 기록하여 향후 참고 및 재현성을 확보한다.

---

## 문제 1: 한글 인코딩 문제

### 발생 시기
Week2

### 문제 상황
- PowerShell 기본 인코딩이 CP949로 설정되어 한글 주석이 깨짐
- 파일 저장 시 인코딩 불일치

### 해결 방법
- 모든 파일을 UTF-8로 저장
- IDE 설정에서 UTF-8 강제
- PowerShell 인코딩 설정 변경

### 결과
- 한글 주석 및 문서가 정상적으로 표시됨
- 모든 파일이 UTF-8로 통일됨

---

## 문제 2: RecursiveCharacterTextSplitter 겹침 오류

### 발생 시기
Week2

### 문제 상황
- 청크 간 겹침 발생
- 중복된 텍스트가 여러 청크에 포함됨

### 해결 방법
- `strip_whitespace` 파라미터 조정
- `chunk_size` 및 `chunk_overlap` 재설정
- 샘플 텍스트로 검증 후 적용

### 결과
- 청크 겹침 문제 해결
- 일관된 청킹 결과 생성

---

## 문제 3: LangChain API 변경 대응

### 발생 시기
Week4

### 문제 상황
- `chain.run()` 메서드가 deprecated
- `BaseRetriever` 위치 변경
- Gemini 모델 버전 변경

### 해결 방법
- `chain.run()` → `chain.invoke()` 변경
- `langchain.retrievers` → `langchain_core.retrievers` import 경로 수정
- Gemini 모델을 `gemini-2.5-flash`로 업데이트

### 결과
- 최신 LangChain API에 맞춰 코드 수정 완료
- 정상 동작 확인

---

## 문제 4: 의존성 충돌

### 발생 시기
Week4, Week5

### 문제 상황 1: langchain-huggingface
- `langchain-core 1.0.4`와 기존 패키지(`langchain-core<0.3.0`) 충돌
- `langchain-huggingface` 설치 시 버전 충돌 발생

### 해결 방법 1
- `langchain-huggingface` 제거
- `langchain_community.embeddings.HuggingFaceEmbeddings`로 대체
- `environment.yml` 및 `requirements.txt` 업데이트

### 문제 상황 2: langchain-core.pydantic_v1
- `langchain 0.2.17` 설치 시 `langchain_core.pydantic_v1` 모듈 오류
- `langchain-core` 버전 불일치

### 해결 방법 2
- `langchain 0.2.17` → `0.2.16` 다운그레이드
- `langchain-core 0.2.43`로 고정
- 버전 호환성 확인

### 결과
- 모든 의존성 충돌 해결
- 안정적인 환경 구축

---

## 문제 5: Import 경로 오류

### 발생 시기
Week5

### 문제 상황
- `rag_chain` 모듈을 찾지 못함
- `reportMissingImports` 오류 발생

### 해결 방법
- `src/week4/__init__.py` 및 `src/week5/__init__.py` 추가
- 패키지 구조 명확화
- `from week4.rag_chain import ...` 형태로 변경
- `sys.path` 조정

### 결과
- 모든 import 경로 정상 동작
- 패키지 구조 명확화

---

## 문제 6: 인덱스 경로 자동 탐색

### 발생 시기
Week5, Week6

### 문제 상황
- 상대 경로(`../../data/processed/index`) 해석 문제
- `metadata.json` 파일을 찾지 못함
- 프로젝트 루트 기준 경로 해석 오류

### 해결 방법
- 프로젝트 루트 기준 절대 경로 변환
- `metadata.json` 자동 탐색 로직 추가
- 하위 디렉토리 재귀 탐색

### 결과
- 인덱스 경로 자동 탐색 기능 구현
- 사용자 편의성 향상

---

## 문제 7: FastAPI ↔ Dash 연결 오류

### 발생 시기
Week7

### 문제 상황
- Week7 Dash 앱이 Week6 API 서버에 연결 실패
- `Connection refused` 오류
- Docker 환경에서 네트워킹 문제

### 해결 방법
- 서버 실행 순서 명확화 (Week6 → Week7)
- Docker Compose `depends_on` 설정
- `host.docker.internal` 사용 (Windows/Mac)
- Linux 환경에서는 호스트 IP 직접 지정

### 결과
- FastAPI와 Dash 정상 연동
- Docker Compose로 동시 실행 가능

---

## 문제 8: f-string 백슬래시 오류

### 발생 시기
Week5

### 문제 상황
- `f"{(response.count('\n') + 1):>8}"` 구문 오류
- f-string 표현식에 백슬래시 직접 사용 불가

### 해결 방법
- 백슬래시를 변수로 분리
- `newline_char = '\n'` 변수 생성 후 사용

### 결과
- 구문 오류 해결
- 정상 동작 확인

---

## 문제 9: Docker 포트 충돌

### 발생 시기
Week6, Week7

### 문제 상황
- 8000 포트 중복 사용
- 여러 컨테이너 동시 실행 시 포트 충돌

### 해결 방법
- Week6/Week7 컨테이너 분리 실행
- Hydra Override로 포트 재지정
- Docker Compose 프로필 사용 (`--profile full`)

### 결과
- 포트 충돌 해결
- 여러 서비스 동시 실행 가능

---

## 문제 10: Gemini API Key 오류

### 발생 시기
전체 기간

### 문제 상황
- API 키가 유효하지 않음
- 환경 변수 전달 문제
- Docker 환경에서 `.env` 파일 로드 실패

### 해결 방법
- `.env` 파일 확인 및 재생성
- Docker 실행 시 `--env-file .env` 옵션 사용
- 환경 변수 직접 전달 (`-e GOOGLE_API_KEY=...`)
- API 키 유효성 재확인

### 결과
- API 키 정상 동작
- 모든 환경에서 정상 실행

---

## 종합 분석

### 해결된 문제 유형
1. **인코딩 문제**: 한글 처리
2. **API 변경**: 라이브러리 버전 업데이트 대응
3. **의존성 충돌**: 패키지 버전 관리
4. **경로 문제**: 상대/절대 경로 해석
5. **네트워킹**: Docker 컨테이너 간 통신
6. **구문 오류**: Python 문법 문제

### 해결 방법 패턴
- **문서 확인**: 공식 문서 및 릴리즈 노트 확인
- **버전 관리**: `environment.yml`과 실제 설치 버전 동기화
- **로깅**: 상세한 에러 메시지 확인
- **단계적 접근**: 문제를 작은 단위로 분해하여 해결

### 향후 개선 사항
- 자동화된 테스트로 문제 조기 발견
- CI/CD 파이프라인 구축
- 의존성 버전 자동 검증

---

**작성일**: 2025년 11월 14일  
**연구자**: [서혁준]

